<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>endless car game</title>
  <style>
    body, html { margin:0; padding:0; font-family:Arial,sans-serif; background:#000; color:#fff; height:100%; }
    #menu, #game, #game-over, #settings-panel { display:none; justify-content:center; align-items:center; height:100vh; flex-direction:column; }
    #menu, #game-over { background:#111; }

    #game { position:relative; overflow:hidden; background:#444; }
    #game::before, #game::after { content:''; position:absolute; top:0; width:10px; height:100%; background:#fff; z-index:1; }
    #game::before { left:10%; }
    #game::after  { right:10%; }
    .center-line { position:absolute; top:0; left:50%; width:2px; height:100%; background-image:linear-gradient(#fff 20px,transparent 20px); background-size:2px 40px; transform:translateX(-50%); z-index:1; }

    #hud { position:absolute; top:0; left:0; width:100%; padding:5px; text-align:center; background:rgba(0,0,0,0.5); z-index:3; font-size:14px; }
    #car { position:absolute; width:70px; height:140px; bottom:10px; left:calc(50% - 35px); background:url('player-car.png') center/contain no-repeat; z-index:2; }
    .obstacle { position:absolute; width:70px; height:140px; background:url('enemy-car.png') center/contain no-repeat; z-index:2; }

    button, select { margin:5px; padding:8px; font-size:14px; z-index:3; }
    #settings-panel { position:absolute; top:10px; left:10px; background:rgba(0,0,0,0.8); padding:10px; border-radius:5px; z-index:3; }
    #leaderboard-menu, #leaderboard { text-align:left; margin-top:20px; }
    #leaderboard-menu h2, #leaderboard h2 { margin-bottom:5px; }
    #leaderboard-menu ol, #leaderboard ol { padding-left:20px; }
  </style>
</head>
<body>
  <div id="menu">
    <h1>endless car game</h1>
    <label>Difficulty:
      <select id="menu-difficulty">
        <option value="3000">Easy</option>
        <option value="2000" selected>Medium</option>
        <option value="1000">Hard</option>
      </select>
    </label>
    <button onclick="startGame()">Start</button>
    <div id="leaderboard-menu">
      <h2>Leaderboard</h2>
      <ol id="leaderboard-list"></ol>
      <button onclick="resetLeaderboard()">Reset Leaderboard</button>
    </div>
  </div>
  <div id="game">
    <div class="center-line"></div>
    <div id="hud">Current: <span id="time">0</span> | Best: <span id="best">0</span></div>
    <div id="car"></div>
    <button onclick="toggleSettings()" style="position:absolute;top:10px;right:10px;">⚙️</button>
    <div id="settings-panel">
      <label>Difficulty:
        <select id="in-game-difficulty" onchange="changeDifficulty()">
          <option value="3000">Easy</option>
          <option value="2000" selected>Medium</option>
          <option value="1000">Hard</option>
        </select>
      </label>
      <div>
        <button onclick="resumeGame()">Continue</button>
        <button onclick="restartGame()">Restart</button>
        <button onclick="quitGame()">Quit</button>
      </div>
    </div>
  </div>
  <div id="game-over">
    <h1>Game Over</h1>
    <p>Final Time: <span id="final-time"></span></p>
    <p>Best Time: <span id="best"></span></p>
    <div id="leaderboard">
      <h2>Leaderboard</h2>
      <ol id="leaderboard-list-end"></ol>
      <button onclick="resetLeaderboard()">Reset Leaderboard</button>
    </div>
    <button onclick="restartGame()">Play Again</button>
    <button onclick="quitGame()">Quit</button>
  </div>
  <script>
    const menu = document.getElementById('menu'), game = document.getElementById('game'), go = document.getElementById('game-over'),
          car = document.getElementById('car'), timeEl = document.getElementById('time'), bestEl = document.getElementById('best'), finalTimeEl = document.getElementById('final-time'),
          mDiff = document.getElementById('menu-difficulty'), iDiff = document.getElementById('in-game-difficulty'), settings = document.getElementById('settings-panel'),
          lbMenu = document.getElementById('leaderboard-list'), lbEnd = document.getElementById('leaderboard-list-end');
    let obstacles = [], diff = 2000, elapsed = 0, gameTimer, spawnTimer, running = false, paused = false;

    function getBoard() { return JSON.parse(localStorage.getItem('leaderboard') || '[]'); }
    function saveBoard(b) { localStorage.setItem('leaderboard', JSON.stringify(b)); }
    function renderBoard(b, el) { el.innerHTML = ''; b.forEach(s => { let li = document.createElement('li'); li.textContent = s; el.appendChild(li); }); }
    function resetLeaderboard() { localStorage.removeItem('leaderboard'); renderBoard([], lbMenu); renderBoard([], lbEnd); }

    function startGame() {
      diff = +mDiff.value; iDiff.value = diff;
      menu.style.display = 'none'; go.style.display = 'none'; game.style.display = 'block';
      car.style.left = 'calc(50% - 35px)'; obstacles = []; elapsed = 0; running = true; paused = false;
      timeEl.textContent = '0'; bestEl.textContent = getBoard()[0] || 0;
      clearInterval(gameTimer);
      gameTimer = setInterval(() => { if (running && !paused) { elapsed++; timeEl.textContent = elapsed; } }, 1000);
      resetSpawn(); requestAnimationFrame(updateObs);
    }

    function resumeGame() { paused = false; settings.style.display = 'none'; }
    function quitGame() { running = false; clearInterval(gameTimer); clearInterval(spawnTimer); game.style.display = 'none'; go.style.display = 'none'; menu.style.display = 'flex'; renderBoard(getBoard(), lbMenu); }
    function moveCar(e) { if (!running || paused) return; let x = car.offsetLeft; if (e.key === 'ArrowLeft' && x > game.clientWidth * 0.1) x -= 25; if (e.key === 'ArrowRight' && x < game.clientWidth * 0.9 - 70) x += 25; car.style.left = x + 'px'; }
    document.addEventListener('keydown', moveCar);

    function spawnObstacle() {
      if (!running) return;
      let o = document.createElement('div'); o.className = 'obstacle'; o.style.top = '-140px';
      let min = game.clientWidth * 0.1, max = game.clientWidth * 0.9 - 70;
      o.style.left = (Math.random() * (max - min) + min) + 'px';
      game.appendChild(o); obstacles.push(o);
    }

    function resetSpawn() { clearInterval(spawnTimer); spawnTimer = setInterval(spawnObstacle, diff); }

    function updateObs() {
      if (!running) return;
      if (paused) { requestAnimationFrame(updateObs); return; }
      for (let i = obstacles.length - 1; i >= 0; i--) {
        let o = obstacles[i];
        let t = parseFloat(o.style.top) + (diff === 1000 ? 5 : diff === 2000 ? 3 : 2);
        o.style.top = t + 'px';
        let c = car.getBoundingClientRect(), r = o.getBoundingClientRect();
        if (r.top < c.bottom && r.bottom > c.top && r.left < c.right && r.right > c.left) return endGame();
        if (t > game.clientHeight) {
          o.remove(); obstacles.splice(i, 1);
        }
      }
      requestAnimationFrame(updateObs);
    }

    function endGame() {
      running = false; clearInterval(gameTimer); clearInterval(spawnTimer);
      game.style.display = 'none'; go.style.display = 'flex'; finalTimeEl.textContent = elapsed;
      let b = getBoard(); b.push(elapsed); b.sort((a,b) => b - a); if (b.length > 5) b.length = 5; saveBoard(b);
      bestEl.textContent = b[0] || 0; renderBoard(b, lbEnd);
    }

    function restartGame() { clearInterval(gameTimer); clearInterval(spawnTimer); document.querySelectorAll('.obstacle').forEach(o => o.remove()); obstacles = []; paused = false; running = false; startGame(); }
    function toggleSettings() { paused = true; settings.style.display = 'flex'; }
    function changeDifficulty() { diff = +iDiff.value; resetSpawn(); }

    menu.style.display = 'flex'; renderBoard(getBoard(), lbMenu);
  </script>
</body>
</html>
